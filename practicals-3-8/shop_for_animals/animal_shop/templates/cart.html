{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="welcome-section" style="margin-bottom: -2rem">
    <h2 style="text-align: center;">Your Shopping Cart</h2>
</section>

<div class="container">
    <div class="product-page-wrapper">
        {% if cart_items %}
            <div class="cart-items-section card">
                <div class="section-header">
                    <h3>ðŸ›’ Cart Items ({{ cart_count }} item{{ cart_count|pluralize }})</h3>
                </div>

                {% for item in cart_items %}
                <div class="cart-item" style="display: flex; gap: var(--spacing-unit); padding: var(--spacing-unit); border-bottom: var(--border-width) solid var(--sage); align-items: center;">
                    <div class="item-image" style="flex-shrink: 0;">
                        {% if item.product.image %}
                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" style="width: 80px; height: 80px; object-fit: cover; border-radius: var(--border-radius);">
                        {% else %}
                            <div style="width: 80px; height: 80px; background-color: var(--sage); display: flex; align-items: center; justify-content: center; border-radius: var(--border-radius); color: var(--plum);">No Image</div>
                        {% endif %}
                    </div>

                    <div class="item-details" style="flex-grow: 1;">
                        <h4>{{ item.product.name }}</h4>
                        <p style="color: var(--plum); margin: 0.5rem 0;">Â£{{ item.price }} each</p>
                        <div class="stock-indicator card card-stock" style="display: inline-flex;">
                            <div class="pulse-dot" style="background: {{ item.product.get_stock_display_color }};"></div>
                            <span>{{ item.product.get_stock_status_display }}</span>
                        </div>
                    </div>

                    <div class="item-quantity" style="display: flex; align-items: center; gap: 0.5rem;">
                        <form method="post" action="{% url 'update_cart' item.product.id %}" style="display: flex; align-items: center; gap: 0.5rem;">
                            {% csrf_token %}
                            <label for="quantity-{{ item.product.id }}" style="font-size: var(--fs-small);">Qty:</label>
                            <input type="number" name="quantity" id="quantity-{{ item.product.id }}" value="{{ item.quantity }}" min="1" max="99" style="width: 60px; padding: 0.25rem; text-align: center; border: var(--border-width) solid var(--plum); border-radius: var(--border-radius);">
                            <button type="submit" class="btn btn-primary" style="font-size: var(--fs-small); padding: 0.25rem 0.5rem;">Update</button>
                        </form>
                    </div>

                    <div class="item-total" style="text-align: right; min-width: 80px;">
                        <p style="font-weight: bold; color: var(--plum); margin: 0;">Â£{{ item.total|floatformat:2 }}</p>
                    </div>

                    <div class="item-remove">
                        <a href="{% url 'remove_from_cart' item.product.id %}" class="btn" style="background: var(--coral); color: white; padding: 0.25rem 0.5rem; font-size: var(--fs-small);" onclick="return confirm('Remove this item from cart?')">Remove</a>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="cart-summary card">
                <div class="summary-content" style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-unit);">
                    <div class="summary-info">
                        <h3>Order Summary</h3>
                        <p>Total Items: {{ cart_count }}</p>
                    </div>
                    <div class="summary-total" style="text-align: right;">
                        <div class="total-price" style="font-size: var(--fs-large); font-weight: bold; color: var(--plum);">
                            Total: Â£{{ total_price|floatformat:2 }}
                        </div>
                        <div class="checkout-actions" style="margin-top: var(--spacing-unit);">
                            <a href="{% url 'checkout' %}" class="btn btn-primary" style="padding: var(--spacing-unit); font-size: var(--fs-medium);">
                                <span class="btn-icon">ðŸ’³</span>
                                <span class="btn-text">Proceed to Checkout</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

        {% else %}
            <div class="empty-cart card" style="text-align: center; padding: calc(var(--spacing-unit) * 3);">
                <div class="empty-icon" style="font-size: 4rem; margin-bottom: var(--spacing-unit);">ðŸ›’</div>
                <h3>Your cart is empty</h3>
                <p style="margin: var(--spacing-unit) 0;">Looks like you haven't added any magical treats yet!</p>
                <a href="{% url 'catalog' %}" class="btn btn-primary">
                    <span class="btn-text">Continue Shopping</span>
                </a>
            </div>
        {% endif %}

        <div class="cart-actions" style="margin-top: calc(var(--spacing-unit) * 2); text-align: center;">
            <a href="{% url 'catalog' %}" class="btn btn-back">
                <span>Continue Shopping</span>
            </a>
        </div>
    </div>
</div>

{% if messages %}
<div class="messages" style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}" style="background: {% if message.tags == 'success' %}var(--sage){% elif message.tags == 'error' %}var(--coral){% else %}var(--plum){% endif %}; color: white; padding: var(--spacing-unit); border-radius: var(--border-radius); margin-bottom: 0.5rem; max-width: 300px;">
        {{ message }}
    </div>
    {% endfor %}
</div>

<script>
    setTimeout(function() {
        const messages = document.querySelector('.messages');
        if (messages) {
            messages.style.opacity = '0';
            setTimeout(() => messages.remove(), 500);
        }
    }, 5000);
</script>
{% endif %}
{% endblock %}